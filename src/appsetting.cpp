#include "appsetting.hpp"

using namespace App;
using namespace std;


AppSetting::AppSetting()
{

}

AppSetting::~AppSetting()
{

}

void AppSetting::readAppSetting(const QString &path)
{
    try
    {
        //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //判断配置文件在目录中是否存在
        //将数据写入至配置文件中
        if(!QFile::exists(path))
        {
            writeAppSetting(path);
        }
        //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //如果配置文件存在,则读取文件中相应的数据并判断数据是否符合要求
        //如果数据不符合要求,则将该字段数据写为默认值
        else
        {
            //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //step1
            //读取文件Theme内容,并判断是否在枚举中,如果不在则写入默认值
            QSettings configFile(path,QSettings::IniFormat);

            QString theme = configFile.value("Theme").toString();

            if(theme != "Black" && theme != "White")
            {
                configFile.setValue("Theme","Black");
            }

            //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

            //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //step2
            //读取文件Lang内容,并判断是否在枚举中,如果不在则写入默认值
            QString lang = configFile.value("Lang").toString();

            if(lang != "CN" && lang != "EN" )
            {
                configFile.setValue("Lang","CN");
            }

            //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

            //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //step3
            //读取文件LaneMode内容,并判断是否在枚举中,如果不在则写入默认值
            QString laneMode = configFile.value("LaneMode").toString();

            if(laneMode != "SingleLane" &&
               laneMode != "DualLane" &&
               laneMode != "Simulator")
            {
                configFile.setValue("LaneMode","SingleLane");
            }
            //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

            //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //step4
            //读取文件MachineType内容,并判断是否在枚举中,如果不在则写入默认值
            QString machineType = configFile.value("MachineType").toString();

            if(machineType != "AOI" && machineType != "SPI")
            {
                configFile.setValue("MachineType","AOI");
            }

            //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

            //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //step5
            //读取文件CompanyName内容,并判断是否在枚举中,如果不在则写入默认值
            QString name = configFile.value("CompanyName").toString();

            if(name.toStdString() != AppSetting::m_pCompanyName[0] &&
               name.toStdString() != AppSetting::m_pCompanyName[1])
            {
                configFile.setValue("CompanyName","Scijet");
            }
            //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        }

        //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    }
    //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    //如果捕获异常,则输出异常信息
    catch(const exception &ex)
    {
        THROW_EXCEPTION(ex.what());
    }
    //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
}

void AppSetting::writeAppSetting(const QString &path)
{
    //>>>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    //将类QSettings实例化一个对象
    //path:存放文件的路径
    //QSettings::IniFormat: 为存放文件的格式
    QSettings configFile(path,QSettings::IniFormat);

    //将软件的主题写入文件,默认为"Black"
    configFile.setValue("Theme","Black");
    //将公司名称写入至文件,默认为"Scijet"
    configFile.setValue("CompanyName","Scijet");
    //将设备类型写入至文件,默认为"AOI"
    configFile.setValue("MachineType","AOI");
    //将设备的轨道模式写入文件,默认为"SingleLane"
    configFile.setValue("LaneMode","SingleLane");
    //将软件的语言写入文件,默认为"CN"
    configFile.setValue("Lang","CN");

    //<<<----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
}
